<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AHP</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='scss/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='scss/chart.css') }}">
  <script src="{{ url_for('static', filename='js/criteria.js') }}"></script>
  <script src="{{ url_for('static', filename='js/datasets.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='js/visualization.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>



</head>
<body>
  <div class="header-top">
    AHP TRONG ÄÃNH GIÃ TIá»€M NÄ‚NG Äáº¤T ÄAI CHO CÃ‚Y MACCA Táº I HUYá»†N TUY Äá»¨C, Tá»ˆNH Äáº®K NÃ”NG
  </div>

  <div class="tab-bar">
    <button class="tab-button active" onclick="showTab('criteria')">ÄÃ¡nh giÃ¡ tiÃªu chÃ­	</button>
    <button class="tab-button" onclick="showTab('datasets')">ÄÃ¡nh giÃ¡ phÆ°Æ¡ng Ã¡n</button>
    <button class="tab-button" onclick="showTab('results')">Káº¿t quáº£ lá»±a chá»n</button>
    <button class="tab-button" onclick="showTab('visualization')">Trá»±c quan hoÃ¡</button>

  </div>

  <div class="main">
    <div class="content">
      <div id="criteria" class="tab-content active" style="overflow-y: auto; height: 100%;">
        <h3>XÃ¡c Ä‘á»‹nh tiÃªu chÃ­</h3>
        <div style="margin: 10px;">
          <label for="excelUpload">ğŸ“¥ Nháº­p ma tráº­n tá»« Excel:</label>
         <input type="file" id="excelUpload" accept=".xlsx,.xls" />

        </div>
        

        <div class="input-row">
          <label for="numCriteria">Nháº­p sá»‘ lÆ°á»£ng tiÃªu chÃ­ (tá»‘i Ä‘a 15):</label>

          <input type="number" id="numCriteria" min="1" max="15" value="8" />

        </div>
        <p id="criteriaError" style="color: red; display: none; margin-top: 4px;"></p>
        

        <button onclick="generateMatrix()">XÃ¡c nháº­n</button>
        <div id="criteriaNamesContainer" style="margin-top: 20px;"></div>
        <div id="confirmCriteriaNames" style="margin-top: 10px;"></div>
        <div id="matrixContainer"></div>
      </div>

      <div id="datasets" class="tab-content">
       
        <h3>XÃ¡c Ä‘á»‹nh phÆ°Æ¡ng Ã¡n</h3>

        <label for="numAlternatives">Sá»‘ phÆ°Æ¡ng Ã¡n:</label>
        <input type="number" id="numAlternatives" min="2" max="10" value="4" />
        <button onclick="generateAlternatives()">Táº¡o danh sÃ¡ch phÆ°Æ¡ng Ã¡n</button>

        <div id="alternativesNamesContainer" style="margin-top: 20px;"></div>
        <div id="alternativesMatrixContainer" style="margin-top: 20px;"></div>
        



      </div>
     
      <div id="results" class="tab-content">
       
        <h3>TÃ³m táº¯t káº¿t quáº£ AHP</h3>
       
      </div>
      <div id="visualization" class="tab-content">
        <button onclick="exportChartsToPDF()">ğŸ“¤ Xuáº¥t biá»ƒu Ä‘á»“ ra PDF</button>

        <div class="chart-row">
          <div class="chart-item">
            <h4>1. Biá»ƒu Ä‘á»“ trÃ²n â€“ Trá»ng sá»‘ tiÃªu chÃ­</h4>
            <canvas id="criteriaPieChart" width="400" height="350"></canvas>
          </div>

          <div class="chart-item">
            <h4>2. Biá»ƒu Ä‘á»“ radar â€“ So sÃ¡nh phÆ°Æ¡ng Ã¡n</h4>
            <canvas id="radarChart" width="500" height="400"></canvas>
          </div>

          <div class="chart-item">
            <h4>3. Biá»ƒu Ä‘á»“ cá»™t â€“ Tá»•ng Ä‘iá»ƒm phÆ°Æ¡ng Ã¡n</h4>
            <canvas id="finalChart" width="600" height="350"></canvas>
          </div>
        </div>
      </div>

       </div>

    </div>


  </div>

</body>
</html>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const excelInput = document.getElementById("excelUpload");

    if (excelInput) {
      excelInput.addEventListener("change", function () {
        const file = this.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

          console.log("ğŸ“¥ Excel Ä‘á»c Ä‘Æ°á»£c:", rows);

          if (rows.length < 2 || rows[0].length !== rows.length - 1) {
            alert("âŒ File Excel khÃ´ng há»£p lá»‡. HÃ ng Ä‘áº§u lÃ  tÃªn tiÃªu chÃ­, cÃ¡c hÃ ng sau lÃ  ma tráº­n vuÃ´ng.");
            return;
          }

          const names = rows[0].map(n => String(n).trim());
          const matrix = rows.slice(1);
          document.getElementById("numCriteria").value = names.length;

          generateMatrix();

          setTimeout(() => {
            for (let i = 0; i < names.length; i++) {
              document.getElementById(`crit-name-${i}`).value = names[i];
            }

            confirmNames(names.length);

            setTimeout(() => {
              for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix.length; j++) {
                  if (i === j) continue;
                  const val = matrix[i][j];
                  const cell = document.getElementById(`cell-${i}-${j}`);
                  if (cell) {
                    const text = typeof val === "number" ? toFraction(val) : String(val).trim();
                    cell.value = text;
                    if (i < j) handleInput(i, j, text);
                  }
                }
              }
            }, 200);
          }, 200);
        };

        reader.readAsArrayBuffer(file);
      });
    } else {
      console.warn("â— KhÃ´ng tÃ¬m tháº¥y input Excel vá»›i ID 'excelUpload'");
    }
  });
  async function exportChartsToPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p', 'mm', 'a4');

  const canvasIds = ['criteriaPieChart', 'radarChart', 'finalChart'];
  const titles = ['1', '2', '3'];

  for (let i = 0; i < canvasIds.length; i++) {
    const canvas = document.getElementById(canvasIds[i]);
    const imgData = canvas.toDataURL('image/png');

    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;
    
    const maxWidth = 180; // mm
    const scale = maxWidth / canvasWidth;
    const scaledWidth = canvasWidth * scale;
    const scaledHeight = canvasHeight * scale;

    pdf.setFontSize(14);
    pdf.text(titles[i], 10, 10);

    pdf.addImage(imgData, 'PNG', 10, 15, scaledWidth, scaledHeight);

    if (i < canvasIds.length - 1) {
      pdf.addPage();
    }
  }

  pdf.save('AHP_Charts.pdf');
}

</script>
